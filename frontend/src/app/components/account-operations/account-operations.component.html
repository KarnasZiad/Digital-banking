<div class="row">
  <div class="col-md-12">
    <h2>üìä Historique des Op√©rations</h2>
  </div>
</div>

<!-- Informations du compte -->
<div class="row mt-3" *ngIf="account">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Compte {{ account.id }}</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3">
            <strong>Client:</strong> {{ account.customerDTO?.name }}
          </div>
          <div class="col-md-3">
            <strong>Type:</strong>
            <span class="badge" [class]="account.type === 'CurrentAccount' ? 'bg-primary' : 'bg-success'">
              {{ account.type === 'CurrentAccount' ? 'Courant' : '√âpargne' }}
            </span>
          </div>
          <div class="col-md-3">
            <strong>Solde:</strong>
            <span [class]="account.balance >= 0 ? 'text-success' : 'text-danger'">
              {{ account.balance | currency:'EUR' }}
            </span>
          </div>
          <div class="col-md-3">
            <strong>Statut:</strong>
            <span class="badge bg-success">{{ account.status }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Contr√¥les de pagination -->
<div class="row mt-3">
  <div class="col-md-6">
    <div class="input-group">
      <span class="input-group-text">Taille de page:</span>
      <select class="form-select" [(ngModel)]="pageSize" (change)="loadAccountHistory()">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
    </div>
  </div>
  <div class="col-md-6">
    <button class="btn btn-outline-secondary" (click)="loadAccountHistory()">
      üîÑ Actualiser
    </button>
  </div>
</div>

<!-- Historique des op√©rations -->
<div class="row mt-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Historique des Op√©rations</h5>
      </div>
      <div class="card-body">
        <div *ngIf="loading" class="text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>

        <div *ngIf="!loading && accountHistory && accountHistory.accountOperationDTOS.length === 0" class="text-center text-muted">
          Aucune op√©ration trouv√©e
        </div>

        <div *ngIf="!loading && accountHistory && accountHistory.accountOperationDTOS.length > 0">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Date</th>
                  <th>Type</th>
                  <th>Montant</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let operation of accountHistory.accountOperationDTOS">
                  <td>{{ operation.operationDate | date:'short' }}</td>
                  <td>
                    <span class="badge" [class]="operation.type === 'DEBIT' ? 'bg-danger' : 'bg-success'">
                      {{ operation.type === 'DEBIT' ? 'D√©bit' : 'Cr√©dit' }}
                    </span>
                  </td>
                  <td [class]="operation.type === 'DEBIT' ? 'text-danger' : 'text-success'">
                    {{ operation.type === 'DEBIT' ? '-' : '+' }}{{ operation.amount | currency:'EUR' }}
                  </td>
                  <td>{{ operation.description }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="row mt-3" *ngIf="accountHistory.totalPages > 1">
            <div class="col-md-12">
              <nav>
                <ul class="pagination justify-content-center">
                  <li class="page-item" [class.disabled]="currentPage === 0">
                    <button class="page-link" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 0">
                      Pr√©c√©dent
                    </button>
                  </li>
                  <li class="page-item"
                      *ngFor="let page of getPageNumbers()"
                      [class.active]="page === currentPage">
                    <button class="page-link" (click)="goToPage(page)">
                      {{ page + 1 }}
                    </button>
                  </li>
                  <li class="page-item" [class.disabled]="currentPage === accountHistory.totalPages - 1">
                    <button class="page-link"
                            (click)="goToPage(currentPage + 1)"
                            [disabled]="currentPage === accountHistory.totalPages - 1">
                      Suivant
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          </div>

          <!-- Informations de pagination -->
          <div class="row">
            <div class="col-md-12 text-center text-muted">
              Page {{ currentPage + 1 }} sur {{ accountHistory.totalPages }}
              ({{ accountHistory.accountOperationDTOS.length }} op√©rations affich√©es)
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
