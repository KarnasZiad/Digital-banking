<div class="row">
  <div class="col-md-12">
    <h2>üí≥ Gestion des Comptes Bancaires</h2>
  </div>
</div>

<!-- Boutons d'action -->
<div class="row mt-3">
  <div class="col-md-6">
    <button class="btn btn-success me-2" (click)="showCreateAccountForm = !showCreateAccountForm">
      ‚ûï Nouveau Compte
    </button>
    <button class="btn btn-info me-2" (click)="showTransactionForm = !showTransactionForm">
      üí∞ Transaction
    </button>
  </div>
  <div class="col-md-6">
    <div class="input-group">
      <input
        type="text"
        class="form-control"
        placeholder="ID du compte..."
        [(ngModel)]="searchAccountId">
      <button class="btn btn-outline-secondary" type="button" (click)="searchAccount()">
        üîç Rechercher
      </button>
    </div>
  </div>
</div>

<!-- Formulaire de cr√©ation de compte -->
<div class="row mt-3" *ngIf="showCreateAccountForm">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Cr√©er un Nouveau Compte</h5>
      </div>
      <div class="card-body">
        <form (ngSubmit)="createAccount()" #accountForm="ngForm">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="customerId" class="form-label">Client *</label>
                <select
                  class="form-select"
                  id="customerId"
                  [(ngModel)]="newAccount.customerId"
                  name="customerId"
                  required>
                  <option value="">S√©lectionner un client</option>
                  <option *ngFor="let customer of customers" [value]="customer.id">
                    {{ customer.name }} ({{ customer.email }})
                  </option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="accountType" class="form-label">Type de compte *</label>
                <select
                  class="form-select"
                  id="accountType"
                  [(ngModel)]="newAccount.type"
                  name="accountType"
                  required>
                  <option value="">S√©lectionner le type</option>
                  <option value="current">Compte Courant</option>
                  <option value="saving">Compte √âpargne</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="initialBalance" class="form-label">Solde initial *</label>
                <input
                  type="number"
                  class="form-control"
                  id="initialBalance"
                  [(ngModel)]="newAccount.initialBalance"
                  name="initialBalance"
                  min="0"
                  step="0.01"
                  required>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="newAccount.type">
            <div class="col-md-6" *ngIf="newAccount.type === 'current'">
              <div class="mb-3">
                <label for="overDraft" class="form-label">D√©couvert autoris√©</label>
                <input
                  type="number"
                  class="form-control"
                  id="overDraft"
                  [(ngModel)]="newAccount.overDraft"
                  name="overDraft"
                  min="0"
                  step="0.01">
              </div>
            </div>
            <div class="col-md-6" *ngIf="newAccount.type === 'saving'">
              <div class="mb-3">
                <label for="interestRate" class="form-label">Taux d'int√©r√™t (%)</label>
                <input
                  type="number"
                  class="form-control"
                  id="interestRate"
                  [(ngModel)]="newAccount.interestRate"
                  name="interestRate"
                  min="0"
                  max="100"
                  step="0.01">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <button type="submit" class="btn btn-success me-2" [disabled]="!accountForm.form.valid">
                üíæ Cr√©er le Compte
              </button>
              <button type="button" class="btn btn-secondary" (click)="cancelCreateForm()">
                ‚ùå Annuler
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Formulaire de transaction -->
<div class="row mt-3" *ngIf="showTransactionForm">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Effectuer une Transaction</h5>
      </div>
      <div class="card-body">
        <form (ngSubmit)="executeTransaction()" #transactionForm="ngForm">
          <div class="row">
            <div class="col-md-3">
              <div class="mb-3">
                <label for="transactionType" class="form-label">Type *</label>
                <select
                  class="form-select"
                  id="transactionType"
                  [(ngModel)]="transaction.type"
                  name="transactionType"
                  required>
                  <option value="">S√©lectionner</option>
                  <option value="debit">D√©bit</option>
                  <option value="credit">Cr√©dit</option>
                  <option value="transfer">Virement</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="sourceAccount" class="form-label">Compte source *</label>
                <input
                  type="text"
                  class="form-control"
                  id="sourceAccount"
                  [(ngModel)]="transaction.sourceAccountId"
                  name="sourceAccount"
                  placeholder="ID du compte"
                  required>
              </div>
            </div>
            <div class="col-md-3" *ngIf="transaction.type === 'transfer'">
              <div class="mb-3">
                <label for="destinationAccount" class="form-label">Compte destination *</label>
                <input
                  type="text"
                  class="form-control"
                  id="destinationAccount"
                  [(ngModel)]="transaction.destinationAccountId"
                  name="destinationAccount"
                  placeholder="ID du compte destination">
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="amount" class="form-label">Montant *</label>
                <input
                  type="number"
                  class="form-control"
                  id="amount"
                  [(ngModel)]="transaction.amount"
                  name="amount"
                  min="0.01"
                  step="0.01"
                  required>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <input
                  type="text"
                  class="form-control"
                  id="description"
                  [(ngModel)]="transaction.description"
                  name="description"
                  placeholder="Description de la transaction">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <button type="submit" class="btn btn-primary me-2" [disabled]="!transactionForm.form.valid">
                üí∏ Ex√©cuter la Transaction
              </button>
              <button type="button" class="btn btn-secondary" (click)="cancelTransactionForm()">
                ‚ùå Annuler
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Liste des comptes -->
<div class="row mt-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <h5>Liste des Comptes ({{ accounts.length }})</h5>
      </div>
      <div class="card-body">
        <div *ngIf="loading" class="text-center">
          <div class="spinner-border" role="status">
            <span class="visually-hidden">Chargement...</span>
          </div>
        </div>

        <div *ngIf="!loading && accounts.length === 0" class="text-center text-muted">
          Aucun compte trouv√©
        </div>

        <div *ngIf="!loading && accounts.length > 0" class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Client</th>
                <th>Solde</th>
                <th>Statut</th>
                <th>Date cr√©ation</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let account of accounts">
                <td>{{ account.id }}</td>
                <td>
                  <span class="badge" [class]="account.type === 'CurrentAccount' ? 'bg-primary' : 'bg-success'">
                    {{ account.type === 'CurrentAccount' ? 'Courant' : '√âpargne' }}
                  </span>
                </td>
                <td>{{ account.customerDTO?.name }}</td>
                <td>
                  <span [class]="account.balance >= 0 ? 'text-success' : 'text-danger'">
                    {{ account.balance | currency:'EUR' }}
                  </span>
                </td>
                <td>
                  <span class="badge" [class]="getStatusClass(account.status)">
                    {{ account.status }}
                  </span>
                </td>
                <td>{{ account.createdAt | date:'short' }}</td>
                <td>
                  <button class="btn btn-sm btn-outline-info me-1" (click)="viewAccountHistory(account)">
                    üìä Historique
                  </button>
                  <button class="btn btn-sm btn-outline-warning" (click)="quickTransaction(account)">
                    üí∞ Transaction
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>